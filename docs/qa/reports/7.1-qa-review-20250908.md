# QA Review Report: Story 7.1 Tokens 与工具类全局化（P0）

- Date: 2025-09-08
- Story: docs/stories/7.1.tokens-and-utilities-globalization.md
- Assessment: docs/qa/assessments/7.1-impl-test-20250908.md
- Gate: docs/qa/gates/7.1-implementation.yml

## 执行摘要
- Gate 决策: CONCERNS（部分通过）
- 结论：全局 tokens 与工具类已建立，但目标页面首批替换未完成；Tokens 文档未补“工具类映射”。

## 评审范围（按 AC）
- AC-1 扩充 `styles/tokens.wxss`（品牌/语义/灰阶/角色/间距/圆角/阴影/动效/z-index/透明度）
- AC-2 在 `app.wxss` 全局引入 tokens，并提供文本/背景/阴影/圆角/间距等工具类
- AC-3 首批页面硬编码替换：`pages/activities/form.*`、`pages/tenancies/form.*`、`pages/stats/index.*`
- AC-4 文档追加“工具类映射”小节（tokens → utilities 对照）

## 结论（逐项）
- AC-1: PASS（见 Evidence-1）
- AC-2: PASS（见 Evidence-2）
- AC-3: PARTIAL（`tenancies/form.*` 基本达标；`activities/form.*`、`stats/index.*` 仍大量十六进制/渐变硬编码）
- AC-4: FAIL（tokens.md 未新增“工具类映射”章节）

## 证据
- Evidence-1（Tokens 覆盖）：`miniprogram/styles/tokens.wxss` 中包含品牌/语义/灰阶/角色、间距、圆角、阴影、动效、z-index、透明度等完整段落
- Evidence-2（全局引入与工具类）：`miniprogram/app.wxss` 顶部 `@import "styles/tokens.wxss";`，并含 `.text-* / .bg-* / .shadow-* / .rounded-* / .p-* / .px-* / .py-* / .m-* / .mx-* / .my-*`
- Evidence-3（页面硬编码）：
  - `miniprogram/pages/activities/form.wxss` 多处 `linear-gradient(135deg, #...)` 与十六进制色
  - `miniprogram/pages/stats/index.wxss` 多处 `#3B82F6/#1D4ED8/...` 与渐变硬编码
  - `miniprogram/pages/tenancies/form.wxss` 未检出明显十六进制硬编码（良好）

## 复现命令
```sh
# 查看 tokens 与 app.wxss 设置
sed -n '1,120p' miniprogram/styles/tokens.wxss
sed -n '1,160p' miniprogram/app.wxss

# 扫描工具类是否存在
rg -n "\\.(text-primary|text-secondary|bg-primary|bg-subtle|shadow-sm|shadow-md|rounded-md|p-6|px-6|py-6)\\b" miniprogram/app.wxss

# 扫描目标页面十六进制硬编码（需替换）
rg -n "#([0-9a-fA-F]{3,6})" miniprogram/pages/activities/form.wxss
rg -n "#([0-9a-fA-F]{3,6})" miniprogram/pages/tenancies/form.wxss
rg -n "#([0-9a-fA-F]{3,6})" miniprogram/pages/stats/index.wxss
```

## 风险评估
- 视觉一致性/主题联动仍受硬编码影响；后续替换集中于 `activities/form` 与 `stats/index`，工期与回归需预留。

## 整改建议与行动项
- Code（P0 内完成）：
  1. `activities/form.wxss`：将导航头/强调色改为工具类或 var()；渐变统一 tokens 主/辅色或 `--gradient-primary`
  2. `stats/index.wxss`：KPI/徽章/趋势文本等采用 `.text-success/.text-danger/.text-secondary` 等；底色用 `.bg-gray-50` 等；渐变统一 tokens
- Docs（同步）：
  3. `docs/uiux/design-system/tokens.md` 新增“工具类映射”表（text/bg/shadow/rounded/padding/margin），并加章节锚点

### 行动项跟踪
- Owner: 前端小程序组
- Due: 本迭代（P0）
- 验收：
  - [ ] `activities/form.*` 无裸十六进制/渐变硬编码；工具类/var() 替代≥90%
  - [ ] `stats/index.*` 同上
  - [ ] `tokens.md` 含“工具类映射”章节并已 PR 合入
  - [ ] 以上变更经微信开发者工具走查，无 UI 回归

## 决策
- 初始 Gate: CONCERNS（实施整改后复检）。
- 复检 Gate: PASS（activities/form 与 stats/index 硬编码已替换；tokens.md 已补“工具类映射”）。

### 复检补充
- 复检记录：docs/qa/assessments/7.1-impl-retest-20250908.md
- Gate 更新：docs/qa/gates/7.1-implementation.yml（状态已改为 PASS）
