# EP-01 患者与家庭档案

## 目标
- 建立完整、可去重的患者/家庭档案，支持列表/详情/编辑，敏感字段按角色与审批脱敏展示。

## 业务价值（KPI）
- 档案查询时间 ≤ 30 秒；重复档案率 < 1%；创建/编辑成功率 ≥ 99%。

## 范围
- In: 创建/编辑档案；身份证唯一去重；列表/搜索/筛选/分组；详情页脱敏显示；母亲信息解析（手机号/身份证）。
- Out: 批量合并重复档案（后续）；附件管理（照片除外）；复杂模糊搜索。

## 关键用户故事（示例）
- 作为社工，我可以创建患者档案，系统在提交前校验身份证唯一（冲突提示解决路径）。
- 作为志愿者，我可只读查看脱敏后的基础信息（姓名、证件尾 4 位、诊断级别）。
- 作为管理员/社工，在审批通过的时间窗口内可查看明文字段（身份证/电话）。

## 验收标准（Epic 级）
- 创建/编辑：身份证格式校验、唯一冲突返回 E_CONFLICT、错误文案符合规范。
- 列表/详情：分页稳定，默认返回脱敏字段；审批通过后在有效期内返回明文并审计。
- 可观测性：创建/编辑失败有可追踪 requestId；关键路径日志齐全。

## API 契约影响
- patients.list / get / create / update（见 docs/api/contracts.md）
- 筛选项：name（前缀匹配）、id_card_tail；排序：createdAt desc。

## 数据模型与索引
- Patients：id_card 唯一；name+id_card_tail 组合查询；createdAt desc。

## 权限与安全
- 角色可见性按 docs/data/field-masking-matrix.md；敏感读写入 AuditLogs。

## 依赖与顺序
- 依赖：EP-06 权限与安全（审批与字段过滤）。
- 同步：与 EP-02 入住/退住间通过 patientId 关联。

## 风险与假设
- 无证档案去重可能误判（需人工复核流程）；历史数据质量参差。

## 里程碑
- MVP：创建/编辑/列表/详情（脱敏）；
- Next：搜索增强、重复档案合并工具。

## 指标
- 7 日活跃档案数；查重命中率；审批通过的敏感读取次数（监控）。

## 变更记录
- v0.1 初始化。
