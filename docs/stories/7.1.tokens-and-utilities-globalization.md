# Story 7.1: Tokens 与工具类全局化（P0）

## Status
Done

## Story
作为前端开发者，我希望将设计 Tokens 与常用样式工具类在全局统一管理与引入，从而以最小代价替换页面中的硬编码样式并提升跨页面一致性与可维护性。

## Acceptance Criteria
1. 扩充并完善 `miniprogram/styles/tokens.wxss`，覆盖颜色（品牌/语义/灰阶/角色）、间距、圆角、阴影、动效、z-index、透明度等令牌，取值对齐 `docs/uiux/design-system/tokens.md`。
2. 在 `miniprogram/app.wxss` 全局引入 tokens，并新增工具类（示例）：`.text-primary/.text-secondary/.bg-primary/.bg-subtle/.shadow-sm/.shadow-md/.rounded-md/.p-6/.px-6/.py-6` 等，均以 Tokens 取值实现。
3. 完成第一批硬编码替换：`pages/activities/form.*`、`pages/tenancies/form.*`、`pages/stats/index.*` 中的颜色/阴影/圆角/间距改为调用工具类或引用 tokens 变量，不再出现与 tokens 不一致的硬编码颜色。
4. 文档更新：在 `docs/uiux/design-system/tokens.md` 追加“工具类映射”小节，列出核心工具类与对应 Token 的关系（可作为后续替换清单参考）。

## Tasks / Subtasks
- [x] 扩充 `miniprogram/styles/tokens.wxss`（AC: 1）
  - [x] 颜色：品牌/语义/灰阶/角色（Source: docs/uiux/design-system/tokens.md）
  - [x] 间距/圆角/阴影/动效/z-index/透明度（Source: docs/uiux/design-system/tokens.md）
- [x] `miniprogram/app.wxss` 全局引入 tokens，并新增工具类（AC: 2）
- [x] 替换硬编码（AC: 3）
  - [x] `pages/activities/form.wxss` 与 WXML 对应类名
  - [x] `pages/tenancies/form.wxss` 与 WXML 对应类名
  - [x] `pages/stats/index.wxss` 与 WXML 对应类名
- [x] 更新文档映射清单（AC: 4）

## Dev Notes
- 前端目录与组件位置（Source: docs/architecture/01-frontend.md）：
  - 组件放置于 `miniprogram/components/`；全局样式位于 `miniprogram/app.wxss`；页面样式在各 `pages/<page>/*.wxss`。
- 设计 Tokens 范围（Source: docs/uiux/design-system/tokens.md）：
  - 颜色（品牌/语义/灰阶/角色）、间距、圆角、阴影、动效、z-index、透明度；建议以工具类封装以规避 WXSS 对 CSS 变量限制。
- 编码规范与 A11y（Source: docs/process/coding-standards.md、docs/uiux/design-system/accessibility.md）：
  - 骨架屏出现 ≤300ms；触达尺寸 ≥88rpx；对比度 ≥4.5:1（正文）。
- 文件定位（Source: docs/architecture.md#1-前端-微信小程序-目录建议）：
  - `miniprogram/styles/tokens.wxss`、`miniprogram/app.wxss`、`miniprogram/pages/...`。

### Testing
- 快速静态检查：
  - `rg "#([0-9a-fA-F]{3,6})" miniprogram/pages/{activities,tenancies,stats}/*.wxss` 预期仅保留必要渐变/图片色，其他已替换为工具类或 tokens。
- 视觉走查：
  - 对比改造前后截图，确认颜色/阴影/圆角/间距与 tokens 一致；对比度符合规范（≥4.5:1）。
- E2E：
  - 通过微信开发者工具预览主要页面，确认样式未回归且主题切换不受影响。

## Change Log
| Date       | Version | Description                                  | Author |
|------------|---------|----------------------------------------------|--------|
| 2025-09-08 | 0.1     | 初始草案（从差距报告生成）                   | BMAD   |
| 2025-09-08 | 0.2     | 通过 Story Draft Checklist，状态改为 Approved | BMAD   |
| 2025-09-08 | 1.0     | PO 复核：QA Gate PASS，状态改为 Done；同步报告/门禁链接 | PO     |

## Dev Agent Record
- Agent Model Used: Claude Sonnet 4 (claude-sonnet-4-20250514)
- Debug Log References: N/A
- Completion Notes List: 
  - Successfully expanded tokens.wxss with all design system tokens
  - Added comprehensive utility classes to app.wxss for consistent styling
  - Replaced hardcoded values in activities/form.wxss, tenancies/form.wxss, and stats/index.wxss
  - Updated documentation with utility class mapping
- File List: 
  - miniprogram/styles/tokens.wxss (expanded with full token set)
  - miniprogram/app.wxss (added tokens import and utility classes)
  - miniprogram/pages/activities/form.wxss (replaced hardcoded styles with tokens)
  - miniprogram/pages/tenancies/form.wxss (replaced hardcoded styles with tokens)
  - miniprogram/pages/stats/index.wxss (replaced hardcoded styles with tokens)
  - docs/uiux/design-system/tokens.md (added utility class mapping section) 

## QA Results
- Gate Status: PASS (修复后验证)
- AC-1: PASS - tokens.wxss 已包含完整的设计令牌
- AC-2: PASS - app.wxss 已引入tokens并提供工具类
- AC-3: PASS - 目标页面硬编码已100%替换为tokens
- AC-4: PASS - tokens.md 已添加工具类映射章节
- 验证结果: 所有目标文件无剩余十六进制硬编码
