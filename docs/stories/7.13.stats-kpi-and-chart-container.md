# Story 7.13: 统计页 KPI 卡与图表容器完善（P1）

## Status
Completed

## Story
作为终端用户，我希望统计页的关键指标与图表有一致的卡片与容器表现，数值清晰、留白合理、空数据有占位；作为开发者，我希望抽象 Chart 容器便于后续交互增强。

## Acceptance Criteria
1. 使用 7.5 的 `stat-card` 统一 KPI 卡；间距/字体对齐设计系统。
2. 新增 `miniprogram/components/chart-container/`，负责图表区域的留白/标题/空数据占位。
3. 统计页接入 Chart 容器，空/错/加载状态统一（7.7/7.11）。

## Tasks / Subtasks
- [x] KPI 卡替换（AC: 1）
- [x] Chart 容器组件实现与接入（AC: 2,3）

## Dev Notes
- 组件规范（Source: docs/uiux/design-system/components.md#KPI-Card、#Chart-容器）
- IA：统计页结构（Source: docs/uiux/ia_design.md#📊-统计-TabBar-5）

### Testing
- KPI 卡与 Chart 区在窄屏/长文案下无溢出；空/错/加载显示统一。

## Change Log
| Date       | Version | Description                                  | Author |
|------------|---------|----------------------------------------------|--------|
| 2025-09-08 | 0.1     | 初始草案                                     | BMAD   |
| 2025-09-08 | 0.2     | 通过 Story Draft Checklist，状态改为 Approved | BMAD   |
| 2025-09-09 | 1.0     | 实施完成 + QA通过（PO确认 Completed）         | PO     |

## Dev Agent Record

### Completion Notes
- ✅ 统计页已经在使用 stat-card 组件显示 KPI 指标（44-56行 和 64-96行）
- ✅ 实现了 chart-container 组件：
  - 支持 loading、empty、error 三种状态
  - 统一留白、标题、状态占位
  - 与 7.7/7.11 的 empty-state、error-view 组件集成
- ✅ 统计页成功接入 chart-container 组件（100-128行）
- ✅ 移除了重复的图表样式，统一由组件管理

### File List
- `miniprogram/components/chart-container/index.js` - 组件逻辑 + 无障碍访问改进
- `miniprogram/components/chart-container/index.json` - 组件配置
- `miniprogram/components/chart-container/index.wxml` - 组件模板 + role/aria-label
- `miniprogram/components/chart-container/index.wxss` - 组件样式
- `miniprogram/components/loading-skeleton/index.js` - 支持chart类型
- `miniprogram/components/loading-skeleton/index.wxml` - 添加图表骨架模板
- `miniprogram/components/loading-skeleton/index.wxss` - 图表骨架样式
- `miniprogram/pages/stats/index.json` - 添加组件引用
- `miniprogram/pages/stats/index.wxml` - 接入chart-container组件
- `miniprogram/pages/stats/index.wxss` - 清理冗余样式

### QA Improvements Applied
- ✅ **Loading Skeleton Chart Support**: 添加了完整的 type="chart" 支持，包含标题、控制器和柱状图骨架
- ✅ **Accessibility Enhancements**: 为 chart-container 添加了 role="region" 和动态 aria-label，支持状态描述

## QA Results
\n+- Result: Passed
- Test Plan: 
  - docs/qa/test-plan-stat-card.md
  - docs/qa/test-plan-empty-error.md
  - docs/qa/test-plan-loading-skeleton.md
- QA Report: docs/qa/results/stats-kpi-and-chart-container-qa-report-2025-09-09.md
- Notes:
  - KPI 区与快速统计均使用 stat-card，窄屏滑动与长文案无溢出
  - chart-container 统一了 loading/empty/error，Retry 事件与外层刷新逻辑联通
  - 主题/深色模式表现稳定，间距/圆角/阴影与 tokens 对齐
  - 改进项：loading-skeleton 未支持 `type="chart"`（当前无渲染），建议改为 `type="custom"` 或在组件内支持 `chart`
  - 改进项：chart-container 根容器可补充 `role=region` 与 `aria-label`（如“统计图表：数据趋势”）以增强 A11y
