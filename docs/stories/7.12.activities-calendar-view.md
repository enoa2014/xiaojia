# Story 7.12: 活动日历视图（月/周切换）（P1）

## Status
Completed

## Story
作为终端用户，我希望在活动页以“日历视图”快速浏览与筛选活动，并支持月/周切换，从而更直观地查看安排与可报名项。

## Acceptance Criteria
1. 在 `pages/activities/index` 增加日历视图入口，支持月/周切换与状态筛选（报名中/即将开始/进行中/已结束）。
2. 点击日期或活动卡片可进入详情；支持“我的参与”与“签到”入口跳转（如已存在流程则复用）。
3. 空数据与错误状态使用 7.7 统一组件；加载使用 7.11 骨架。

## Tasks / Subtasks
- [x] 交互与数据结构设计（AC: 1）
- [x] 日历视图实现与切换（AC: 1）
- [x] 跳转与流程对接（AC: 2）
- [x] 状态组件接入（AC: 3）

## Dev Notes
- IA 设计（Source: docs/uiux/ia_design.md#📅-活动-TabBar-4）
- 组件与状态（Source: docs/uiux/design-system/components.md）

### Testing
- 月/周切换无异常；筛选条件与结果一致。
- 进入详情/报名/签到流程通畅；空/错/加载状态一致。

## Change Log
| Date       | Version | Description                                  | Author |
|------------|---------|----------------------------------------------|--------|
| 2025-09-08 | 0.1     | 初始草案                                     | BMAD   |
| 2025-09-08 | 0.2     | 通过 Story Draft Checklist，状态改为 Approved | BMAD   |
| 2025-09-09 | 1.0     | 实施完成 + QA通过（PO确认 Completed）         | PO    |

## Dev Agent Record

### File List
- miniprogram/pages/activities/index.js - 添加日历视图切换、数据加载、事件处理
- miniprogram/pages/activities/index.wxml - 集成日历组件、统一状态组件
- miniprogram/pages/activities/index.wxss - 新增视图切换按钮和日历容器样式
- miniprogram/components/calendar-view/index.js - 增强报名、签到事件处理
- miniprogram/components/calendar-view/index.wxml - 完善活动操作按钮交互

### Completion Notes
- ✅ 日历组件已存在且功能完整，成功集成到活动页面
- ✅ 实现了列表/日历视图切换功能，添加了视图模式按钮
- ✅ 完善了日历中活动的报名、签到功能，支持状态更新
- ✅ 统一使用 empty-state 和 error-view 组件处理空数据和错误状态
- ✅ 使用 loading-skeleton 组件处理日历的加载状态
- ✅ 实现了从日历跳转到活动详情的完整流程

### Debug Log References
- 所有功能按设计要求实现，无阻塞问题
- 日历组件与活动页面数据流完整对接
- 状态管理和用户交互符合 AC 要求

## QA Results

- Result: Passed
- Test Plan: docs/qa/test-plan-activities-calendar.md
- QA Report: docs/qa/results/activities-calendar-qa-report-2025-09-09.md
- Notes:
  - 日历根容器与控制按钮补充 A11y（region/aria-label、上一/下一、切换视图、回到今天）
  - 与 7.7/7.11 一致：空/错/骨架均统一，切换时无闪烁

---
QA Review (2025-09-09) — Quinn
- Gate: PASS
- Evidence: components/calendar-view/* 已实现月/周切换、上一/下一、今天按钮和 A11y；pages/activities/index.* 已集成视图切换与状态筛选；空/错/加载分别接入 empty-state/error-view/loading-skeleton。
- NFR: 交互切换无明显卡顿；弱网下骨架≤300ms 显示并淡出，无闪烁。
- Risks: 周视图跨月边界的活动聚合显示依赖数据转换正确性；建议在自动化里补充跨月周用例。
- Follow-ups: 增加日期单元 `aria-selected` 标识；补充端到端用例覆盖报名/签到后的状态刷新。
