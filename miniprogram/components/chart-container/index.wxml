<view class="chart-container {{disabled ? 'chart-container--disabled' : ''}}" 
      style="height: {{height}}rpx;"
      role="region"
      aria-label="{{ariaDescription}}"
      bindtap="onTap">
  
  <!-- å®¹å™¨å¤´éƒ¨ -->
  <view wx:if="{{title || enableTimeRange || enableFilters}}" class="chart-container__header">
    <text wx:if="{{title}}" class="chart-container__title">{{title}}</text>
    
    <!-- äº¤äº’æ§åˆ¶åŒºåŸŸ -->
    <view class="chart-container__controls">
      <!-- æ—¶é—´èŒƒå›´åˆ‡æ¢ -->
      <view wx:if="{{enableTimeRange}}" class="time-range-switcher" 
            role="tablist" 
            aria-label="æ—¶é—´èŒƒå›´é€‰æ‹©">
        <block wx:for="{{timeRangeOptions}}" wx:key="value">
          <view class="time-range-option {{currentTimeRange === item.value ? 'active' : ''}}"
                role="tab"
                aria-selected="{{currentTimeRange === item.value}}"
                aria-label="é€‰æ‹©{{item.label}}"
                data-value="{{item.value}}"
                bindtap="onTimeRangeChange">
            {{item.label}}
          </view>
        </block>
      </view>
      
      <!-- ç­›é€‰å™¨ -->
      <view wx:if="{{enableFilters && filterOptions.length > 0}}" 
            class="chart-filters"
            aria-label="æ•°æ®ç­›é€‰æ§åˆ¶">
        <block wx:for="{{filterOptions}}" wx:key="key" wx:for-item="filter">
          <view class="filter-group" aria-label="{{filter.label}}ç­›é€‰">
            <text class="filter-label">{{filter.label}}</text>
            <picker mode="selector" 
                    range="{{filter.options}}" 
                    range-key="label" 
                    bindchange="onFilterChange"
                    data-key="{{filter.key}}"
                    aria-label="é€‰æ‹©{{filter.label}}">
              <view class="filter-picker">
                <text class="filter-text">{{filter.currentLabel || filter.placeholder || 'å…¨éƒ¨'}}</text>
                <text class="filter-arrow">ã€‰</text>
              </view>
            </picker>
          </view>
        </block>
        
        <!-- é‡ç½®ç­›é€‰æŒ‰é’® -->
        <view wx:if="{{Object.keys(currentFilters).length > 0}}" 
              class="filter-reset"
              bindtap="onResetFilters">
          é‡ç½®
        </view>
      </view>
      
      <!-- è‡ªå®šä¹‰å¤´éƒ¨é¢å¤–å†…å®¹ -->
      <slot name="header-extra"></slot>
    </view>
  </view>

  <!-- å›¾è¡¨å†…å®¹åŒºåŸŸ -->
  <view class="chart-container__body">
    
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="chart-container__loading">
      <loading-skeleton type="chart" height="{{height > 80 ? (height - 80) + 'rpx' : '200rpx'}}"></loading-skeleton>
    </view>
    
    <!-- é”™è¯¯çŠ¶æ€ï¼ˆæ”¯æŒ mock é”™è¯¯ï¼‰ -->
    <error-view wx:elif="{{error || (enableMock && mockData.hasError)}}" 
                show="{{true}}" 
                error="{{error || 'E_INTERNAL'}}" 
                retry-text="é‡æ–°åŠ è½½"
                variant="compact"
                bindretry="onRetry">
    </error-view>
    
    <!-- ç©ºçŠ¶æ€ï¼ˆæ”¯æŒ mock ç©ºçŠ¶æ€ï¼‰ -->
    <empty-state wx:elif="{{empty || (enableMock && mockData.isEmpty)}}" 
                 show="{{true}}" 
                 icon="ğŸ“Š" 
                 title="æš‚æ— å›¾è¡¨æ•°æ®"
                 description="{{enableMock && mockData.isEmpty ? 'ğŸ§ª Mock ç©ºçŠ¶æ€æ¼”ç¤º' : 'æš‚æ—¶æ²¡æœ‰æ•°æ®å¯å±•ç¤º'}}"
                 variant="compact">
    </empty-state>
    
    <!-- æ­£å¸¸å†…å®¹ -->
    <view wx:else class="chart-container__content">
      <!-- Mock æ•°æ®æ˜¾ç¤º -->
      <view wx:if="{{enableMock && mockData.data}}" class="mock-data-display">
        <view class="mock-data-info">
          <text class="mock-label">ğŸ§ª Mock æ•°æ® ({{mockData.data.type}})</text>
          <button class="mock-refresh-btn" size="mini" bindtap="generateMockData">åˆ·æ–°</button>
        </view>
        <view class="mock-data-preview">
          <text class="mock-data-text">
            {{mockData.data.labels ? mockData.data.labels.join(', ') : 'Mock å›¾è¡¨æ•°æ®å·²ç”Ÿæˆ'}}
          </text>
        </view>
      </view>
      
      <!-- å®é™…å›¾è¡¨å†…å®¹ -->
      <slot></slot>
    </view>
  </view>

  <!-- å®¹å™¨åº•éƒ¨ -->
  <view wx:if="{{!loading && !error && !empty}}" class="chart-container__footer">
    <slot name="footer"></slot>
  </view>
</view>