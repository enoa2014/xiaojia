<view class="calendar-view" role="region" aria-label="æ´»åŠ¨æ—¥å† {{viewMode === 'month' ? 'æœˆè§†å›¾' : 'å‘¨è§†å›¾'}} {{calendarData.year}}å¹´{{calendarData.month}}æœˆ">
  <!-- æ—¥å†å¤´éƒ¨æ§åˆ¶æ  -->
  <view class="calendar-header">
    <view class="calendar-controls">
      <button class="control-btn" bindtap="onPrevious" aria-label="ä¸Šä¸€æœˆæˆ–ä¸Šä¸€å‘¨">
        <text class="control-icon">â€¹</text>
      </button>
      <view class="calendar-title">
        <text class="year-month">{{calendarData.year}}å¹´{{calendarData.month}}æœˆ</text>
        <text class="view-mode {{viewMode}}">{{viewMode === 'month' ? 'æœˆè§†å›¾' : 'å‘¨è§†å›¾'}}</text>
      </view>
      <button class="control-btn" bindtap="onNext" aria-label="ä¸‹ä¸€æœˆæˆ–ä¸‹ä¸€å‘¨">
        <text class="control-icon">â€º</text>
      </button>
    </view>
    
    <view class="calendar-actions">
      <button class="action-btn" bindtap="toggleViewMode" aria-label="åˆ‡æ¢è§†å›¾">
        <text class="action-icon">{{viewMode === 'month' ? 'ğŸ“…' : 'ğŸ“†'}}</text>
      </button>
      <button class="action-btn today-btn" wx:if="{{showToday}}" bindtap="goToToday" aria-label="å›åˆ°ä»Šå¤©">
        <text class="action-text">ä»Šå¤©</text>
      </button>
    </view>
  </view>

  <!-- æ˜ŸæœŸæ ‡é¢˜è¡Œ -->
  <view class="calendar-weekdays">
    <text class="weekday-item">æ—¥</text>
    <text class="weekday-item">ä¸€</text>
    <text class="weekday-item">äºŒ</text>
    <text class="weekday-item">ä¸‰</text>
    <text class="weekday-item">å››</text>
    <text class="weekday-item">äº”</text>
    <text class="weekday-item">å…­</text>
  </view>

  <!-- æ—¥å†ä¸»ä½“ -->
  <view class="calendar-body">
    <view wx:for="{{calendarData.weeks}}" wx:key="index" class="calendar-week">
      <view 
        wx:for="{{item}}" 
        wx:key="date" 
        wx:for-item="dayItem"
        class="calendar-day {{dayItem.isCurrentMonth ? 'current-month' : 'other-month'}} {{dayItem.isToday ? 'today' : ''}} {{dayItem.isSelected ? 'selected' : ''}}"
        aria-label="{{dayItem.date}}ï¼Œ{{dayItem.activities.length}} ä¸ªæ´»åŠ¨"
        data-date="{{dayItem.date}}"
        bindtap="onDateSelect">
        
        <!-- æ—¥æœŸæ•°å­— -->
        <view class="day-number">{{dayItem.day}}</view>
        
        <!-- æ´»åŠ¨æŒ‡ç¤ºå™¨ -->
        <view class="day-activities" wx:if="{{dayItem.activities.length > 0}}">
          <view 
            wx:for="{{dayItem.activities}}" 
            wx:key="id" 
            wx:for-item="activity"
            class="activity-dot {{activity.status}}"
            data-activity="{{activity}}"
            catchtap="onActivityTap">
          </view>
          <view class="activity-count" wx:if="{{dayItem.activities.length > 3}}">
            +{{dayItem.activities.length - 3}}
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- é€‰ä¸­æ—¥æœŸçš„æ´»åŠ¨åˆ—è¡¨ -->
  <view class="selected-date-activities" wx:if="{{selectedDate}}">
    <view class="activities-header">
      <text class="activities-date">{{selectedDate}} çš„æ´»åŠ¨</text>
      <text class="activities-count">({{getActivitiesForDate(selectedDate).length}})</text>
    </view>
    
    <scroll-view class="activities-list" scroll-y="true">
      <view 
        wx:for="{{getActivitiesForDate(selectedDate)}}" 
        wx:key="id" 
        class="activity-item {{item.status}}"
        data-activity="{{item}}"
        bindtap="onActivityTap">
        
        <view class="activity-time">
          <text class="start-time">{{item.startTimeDisplay}}</text>
          <text class="duration" wx:if="{{item.duration}}"> Â· {{item.duration}}</text>
        </view>
        
        <view class="activity-content">
          <view class="activity-title">{{item.title}}</view>
          <view class="activity-meta">
            <text class="activity-category">{{item.categoryName}}</text>
            <text class="activity-location" wx:if="{{item.location}}"> Â· {{item.location}}</text>
            <text class="activity-capacity" wx:if="{{item.capacity}}"> Â· {{item.registeredCount || 0}}/{{item.capacity}}äºº</text>
          </view>
        </view>
        
        <view class="activity-status">
          <view class="status-badge {{item.status}}">
            {{statusConfig[item.status].name}}
          </view>
          <button class="activity-action" 
                  wx:if="{{item.canRegister}}" 
                  size="mini"
                  data-activity="{{item}}"
                  catchtap="onRegisterTap">
            æŠ¥å
          </button>
          <button class="activity-action" 
                  wx:elif="{{item.canCheckIn}}" 
                  size="mini"
                  data-activity="{{item}}"
                  catchtap="onCheckInTap">
            ç­¾åˆ°
          </button>
        </view>
      </view>
    </scroll-view>
  </view>
</view>
