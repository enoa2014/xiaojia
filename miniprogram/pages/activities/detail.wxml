<view class="page">
  <view class="nav-header {{theme.headerBg}} full-bleed">
    <view class="brand">ğŸ“„ æ´»åŠ¨è¯¦æƒ…</view>
    <view class="nav-actions"></view>
  </view>
  <view wx:if="{{loading}}" class="loading">åŠ è½½ä¸­...</view>
  <view wx:if="{{!loading && !!error}}" class="error">{{error}}</view>
  <view wx:if="{{!loading && activity}}" class="wrap">
  <view class="card">
    <view class="row">
      <text class="title">{{activity.title}}</text>
      <text class="badge status-{{activity.status}}">{{activity.status}}</text>
    </view>
    <view class="meta">{{activity.date}} Â· {{activity.location}} Â· å®¹é‡ {{activity.capacity}}</view>
  </view>

  <view class="actions">
    <!-- User participation actions -->
    <view class="user-actions">
      <button wx:if="{{!myReg || myReg.status==='cancelled'}}" class="primary" bindtap="doRegister">æŠ¥å</button>
      <button wx:elif="{{myReg.status==='registered' || myReg.status==='waitlist'}}" class="warn" bindtap="doCancel">å–æ¶ˆæŠ¥å</button>
      <button wx:if="{{myReg && !myReg.checkedInAt}}" class="secondary" bindtap="doCheckin">ç­¾åˆ°</button>
      <view wx:if="{{myReg}}" class="hint">
        å½“å‰çŠ¶æ€ï¼š{{myReg.status}} {{myReg.checkedInAt ? 'ï¼ˆå·²ç­¾åˆ°ï¼‰' : ''}}
      </view>
    </view>
    
    <!-- Management actions (only for authorized users) -->
    <view wx:if="{{canManage}}" class="management-actions">
      <view class="divider"></view>
      <view class="management-title">ç®¡ç†åŠŸèƒ½</view>
      <view class="management-buttons">
        <button class="management-btn" bindtap="goToManagement">
          <text class="btn-icon">âš™ï¸</text>
          <text class="btn-text">æ´»åŠ¨ç®¡ç†</text>
        </button>
        <button class="management-btn" bindtap="goToRegistrations">
          <text class="btn-icon">ğŸ“ˆ</text>
          <text class="btn-text">æŠ¥åç®¡ç†</text>
        </button>
      </view>
    </view>
  </view>
  </view>
</view>
