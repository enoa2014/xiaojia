<view class="page">
  <view class="nav-header {{theme.headerBg}} full-bleed">
    <view class="brand">📄 活动详情</view>
    <view class="nav-actions"></view>
  </view>
  <view wx:if="{{loading}}" class="loading">加载中...</view>
  <view wx:if="{{!loading && !!error}}" class="error">{{error}}</view>
  <view wx:if="{{!loading && activity}}" class="wrap">
  <view class="card">
    <view class="row">
      <text class="title">{{activity.title}}</text>
      <text class="badge status-{{activity.status}}">{{activity.status}}</text>
    </view>
    <view class="meta">{{activity.date}} · {{activity.location}} · 容量 {{activity.capacity}}</view>
  </view>

  <view class="actions">
    <!-- User participation actions -->
    <view class="user-actions">
      <button wx:if="{{!myReg || myReg.status==='cancelled'}}" class="primary" bindtap="doRegister">报名</button>
      <button wx:elif="{{myReg.status==='registered' || myReg.status==='waitlist'}}" class="warn" bindtap="doCancel">取消报名</button>
      <button wx:if="{{myReg && !myReg.checkedInAt}}" class="secondary" bindtap="doCheckin">签到</button>
      <view wx:if="{{myReg}}" class="hint">
        当前状态：{{myReg.status}} {{myReg.checkedInAt ? '（已签到）' : ''}}
      </view>
    </view>
    
    <!-- Management actions (only for authorized users) -->
    <view wx:if="{{canManage}}" class="management-actions">
      <view class="divider"></view>
      <view class="management-title">管理功能</view>
      <view class="management-buttons">
        <button class="management-btn" bindtap="goToManagement">
          <text class="btn-icon">⚙️</text>
          <text class="btn-text">活动管理</text>
        </button>
        <button class="management-btn" bindtap="goToRegistrations">
          <text class="btn-icon">📈</text>
          <text class="btn-text">报名管理</text>
        </button>
      </view>
    </view>
  </view>
  </view>
</view>
