<view class="page">
  <view class="nav-header {{theme.headerBg}} full-bleed">
    <view class="brand">📄 活动详情</view>
    <view class="nav-actions"></view>
  </view>
  <view wx:if="{{loading}}" class="loading">加载中...</view>
  <view wx:if="{{!loading && !!error}}" class="error">{{error}}</view>
  <view wx:if="{{!loading && activity}}" class="wrap">
  <view class="card">
    <view class="row">
      <text class="title">{{activity.title}}</text>
      <text class="badge status-{{activity.status}}">{{activity.status}}</text>
    </view>
    <view class="meta">{{activity.date}} · {{activity.location}} · 容量 {{activity.capacity}}</view>
  </view>

  <view class="actions">
    <!-- User participation actions -->
    <view class="user-actions">
      <ui-button wx:if="{{!myReg || myReg.status==='cancelled'}}" variant="primary" size="md" text="报名" bindtap="doRegister"></ui-button>
      <ui-button wx:elif="{{myReg.status==='registered' || myReg.status==='waitlist'}}" variant="danger" size="md" text="取消报名" bindtap="doCancel"></ui-button>
      <ui-button wx:if="{{myReg && !myReg.checkedInAt}}" variant="secondary" size="md" text="签到" bindtap="doCheckin"></ui-button>
      <view wx:if="{{myReg}}" class="hint">
        当前状态：{{myReg.status}} {{myReg.checkedInAt ? '（已签到）' : ''}}
      </view>
    </view>
    
    <!-- Management actions (only for authorized users) -->
    <view wx:if="{{canManage}}" class="management-actions">
      <view class="divider"></view>
      <view class="management-title">管理功能</view>
      <view class="management-buttons">
        <ui-button ext-class="management-btn" variant="secondary" size="md" icon="⚙️" text="活动管理" bindtap="goToManagement"></ui-button>
        <ui-button ext-class="management-btn" variant="secondary" size="md" icon="📈" text="报名管理" bindtap="goToRegistrations"></ui-button>
      </view>
    </view>
  </view>
  </view>
</view>
