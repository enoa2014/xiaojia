<view class="activity-publish-page" wx:if="{{!loading}}">
  <!-- é¡¶éƒ¨å¯¼èˆªï¼ˆå¯¹é½é¦–é¡µæ ·å¼ï¼Œç§»é™¤è¿”å›ç®­å¤´ï¼‰ -->
  <view class="nav-header {{theme && theme.headerBg || 'nav-header--blue'}}">
    <view class="brand">ğŸ“… {{mode === 'edit' ? 'ç¼–è¾‘æ´»åŠ¨' : 'å‘å¸ƒæ´»åŠ¨'}}</view>
    <view class="nav-actions">
      <button class="draft-btn" bindtap="saveAsDraft" loading="{{autoSaving}}">è‰ç¨¿</button>
    </view>
  </view>

  <!-- è¡¨å•è¿›åº¦æŒ‡ç¤ºå™¨ -->
  <view class="form-progress">
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{formProgress}}%"></view>
    </view>
    <text class="progress-text">{{formProgress}}% å®Œæˆ</text>
  </view>

  <!-- å¤§æ»šåŠ¨æ¡†ï¼šå°†éœ€è¦å¡«å†™çš„è¡¨å•åŒºåŸŸæ•´ä½“åŒ…è£¹ä¸ºå¯æ»šåŠ¨çš„å®¹å™¨ -->
  <view class="form-box">
    <scroll-view class="form-scroll" scroll-y="true">
    <!-- åŸºç¡€ä¿¡æ¯åŒºå— -->
    <view class="form-section">
      <view class="section-header">
        <text class="section-icon">ğŸ“</text>
        <text class="section-title">åŸºç¡€ä¿¡æ¯</text>
        <text class="required-mark">*</text>
      </view>
      
      <view class="section-content">
        <!-- æ´»åŠ¨æ ‡é¢˜ -->
        <view class="{{ errors.title ? 'form-item error' : 'form-item' }}">
          <view class="form-label required">æ´»åŠ¨æ ‡é¢˜</view>
          <input class="form-input" 
                  placeholder="å¦‚ï¼šäº²å­åº·å¤è®­ç»ƒæ´»åŠ¨" 
                  value="{{formData.title}}"
                  data-field="title"
                  bindinput="onFormFieldChange"
                  maxlength="50" />
          <view class="char-count">{{formData.title.length}}/50</view>
          <text class="error-text" wx:if="{{errors.title}}">{{errors.title}}</text>
        </view>

        <!-- æ´»åŠ¨åˆ†ç±» -->
        <view class="{{ errors.category ? 'form-item error' : 'form-item' }}">
          <view class="form-label required">æ´»åŠ¨åˆ†ç±»</view>
          <picker mode="selector" 
                  range="{{categoryOptions}}" 
                  range-key="label"
                  bindchange="onCategoryChange">
            <view class="{{ formData.category ? 'picker-display selected' : 'picker-display placeholder' }}">
              <text wx:if="{{formData.category}}">{{selectedCategoryLabel}}</text>
              <text wx:else>è¯·é€‰æ‹©æ´»åŠ¨åˆ†ç±»</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
          <text class="error-text" wx:if="{{errors.category}}">{{errors.category}}</text>
        </view>

        <!-- æ´»åŠ¨æè¿° -->
        <view class="{{ errors.description ? 'form-item error' : 'form-item' }}">
          <view class="form-label required">æ´»åŠ¨æè¿°</view>
          <textarea class="form-textarea" 
                    placeholder="è¯¦ç»†æè¿°æ´»åŠ¨å†…å®¹ã€ç›®æ ‡å’Œè¦æ±‚..."
                    value="{{formData.description}}"
                    data-field="description"
                    bindinput="onFormFieldChange"
                    maxlength="1000"
                    auto-height />
          <view class="char-count">{{formData.description.length}}/1000</view>
          <text class="error-text" wx:if="{{errors.description}}">{{errors.description}}</text>
        </view>

        <!-- æ´»åŠ¨å°é¢ -->
        <view class="form-item">
          <view class="form-label">æ´»åŠ¨å°é¢</view>
          <view class="cover-upload">
            <view class="cover-preview" wx:if="{{formData.coverImage}}">
              <image src="{{formData.coverImage}}" mode="aspectFill"></image>
              <view class="cover-remove" bindtap="removeCoverImage">
                <text class="remove-icon">âœ•</text>
              </view>
            </view>
            <view class="upload-placeholder" wx:else bindtap="uploadCoverImage">
              <text class="upload-icon">ğŸ“·</text>
              <text class="upload-text">æ·»åŠ å°é¢å›¾ç‰‡</text>
            </view>
          </view>
        </view>
      </view>
      </view>

    <!-- æ—¶é—´åœ°ç‚¹åŒºå— -->
    <view class="form-section">
      <view class="section-header">
        <text class="section-icon">ğŸ•’</text>
        <text class="section-title">æ—¶é—´åœ°ç‚¹</text>
        <text class="required-mark">*</text>
      </view>
      
      <view class="section-content">
        <!-- å¼€å§‹æ—¶é—´ -->
        <view class="{{ (errors.startDate || errors.startTime) ? 'form-item error' : 'form-item' }}">
          <view class="form-label required">å¼€å§‹æ—¶é—´</view>
          <view class="datetime-picker">
            <picker mode="date" 
                    value="{{formData.startDate}}"
                    data-field="startDate"
                    bindchange="onFormFieldChange">
              <view class="{{ formData.startDate ? 'date-input selected' : 'date-input placeholder' }}">
                {{formData.startDate || 'é€‰æ‹©æ—¥æœŸ'}}
              </view>
            </picker>
            <text class="datetime-separator">-</text>
            <picker mode="time" 
                    value="{{formData.startTime}}"
                    data-field="startTime"
                    bindchange="onFormFieldChange">
              <view class="{{ formData.startTime ? 'time-input selected' : 'time-input placeholder' }}">
                {{formData.startTime || 'é€‰æ‹©æ—¶é—´'}}
              </view>
            </picker>
          </view>
          <text class="error-text" wx:if="{{errors.startDate || errors.startTime}}">
            {{errors.startDate || errors.startTime}}
          </text>
        </view>

        <!-- ç»“æŸæ—¶é—´ -->
        <view class="{{ (errors.endDate || errors.endTime) ? 'form-item error' : 'form-item' }}">
          <view class="form-label">ç»“æŸæ—¶é—´</view>
          <view class="datetime-picker">
            <picker mode="date" 
                    value="{{formData.endDate}}"
                    data-field="endDate"
                    bindchange="onFormFieldChange">
              <view class="{{ formData.endDate ? 'date-input selected' : 'date-input placeholder' }}">
                {{formData.endDate || 'é€‰æ‹©æ—¥æœŸ'}}
              </view>
            </picker>
            <text class="datetime-separator">-</text>
            <picker mode="time" 
                    value="{{formData.endTime}}"
                    data-field="endTime"
                    bindchange="onFormFieldChange">
              <view class="{{ formData.endTime ? 'time-input selected' : 'time-input placeholder' }}">
                {{formData.endTime || 'é€‰æ‹©æ—¶é—´'}}
              </view>
            </picker>
          </view>
          <text class="error-text" wx:if="{{errors.endDate || errors.endTime}}">
            {{errors.endDate || errors.endTime}}
          </text>
        </view>

        <!-- æ´»åŠ¨åœ°ç‚¹ -->
        <view class="{{ errors.location ? 'form-item error' : 'form-item' }}">
          <view class="form-label required">æ´»åŠ¨åœ°ç‚¹</view>
          <input class="form-input" 
                 placeholder="å¦‚ï¼šåº·å¤è®­ç»ƒå®¤ã€æ´»åŠ¨å¤§å…..." 
                 value="{{formData.location}}"
                 data-field="location"
                 bindinput="onFormFieldChange"
                 maxlength="100" />
          <view class="char-count">{{formData.location.length}}/100</view>
          <text class="error-text" wx:if="{{errors.location}}">{{errors.location}}</text>
        </view>
      </view>
    </view>

    <!-- æŠ¥åè®¾ç½®åŒºå— -->
    <view class="form-section">
      <view class="section-header">
        <text class="section-icon">ğŸ‘¥</text>
        <text class="section-title">æŠ¥åè®¾ç½®</text>
        <text class="required-mark">*</text>
      </view>
      
      <view class="section-content">
        <!-- å‚ä¸äººæ•° -->
        <view class="{{ errors.capacity ? 'form-item error' : 'form-item' }}">
          <view class="form-label required">å‚ä¸äººæ•°é™åˆ¶</view>
          <input class="form-input" 
                 type="number"
                 placeholder="è¯·è¾“å…¥äººæ•°ä¸Šé™" 
                 value="{{formData.capacity}}"
                 data-field="capacity"
                 bindinput="onFormFieldChange" />
          <view class="form-hint">è®¾ç½®ä¸º0è¡¨ç¤ºä¸é™åˆ¶äººæ•°</view>
          <text class="error-text" wx:if="{{errors.capacity}}">{{errors.capacity}}</text>
        </view>

        <!-- æŠ¥åæ–¹å¼ -->
        <view class="form-item">
          <view class="form-label">æŠ¥åæ–¹å¼</view>
          <view class="radio-group">
            <view class="{{ formData.registrationMode === 'open' ? 'radio-item checked' : 'radio-item' }}"
                  data-field="registrationMode"
                  data-value="open"
                  bindtap="onFormFieldChange">
              <text class="radio-icon">{{formData.registrationMode === 'open' ? 'â—' : 'â—‹'}}</text>
              <text class="radio-label">å¼€æ”¾æŠ¥å</text>
              <text class="radio-desc">ç”¨æˆ·å¯ç›´æ¥æŠ¥åå‚ä¸</text>
            </view>
            <view class="{{ formData.registrationMode === 'approval' ? 'radio-item checked' : 'radio-item' }}"
                  data-field="registrationMode"
                  data-value="approval"
                  bindtap="onFormFieldChange">
              <text class="radio-icon">{{formData.registrationMode === 'approval' ? 'â—' : 'â—‹'}}</text>
              <text class="radio-label">å®¡æ ¸æŠ¥å</text>
              <text class="radio-desc">éœ€è¦ç®¡ç†å‘˜å®¡æ ¸é€šè¿‡</text>
            </view>
          </view>
        </view>

        <!-- æŠ¥åæ—¶é—´ -->
        <view class="form-item">
          <view class="form-label">æŠ¥åæ—¶é—´</view>
          <view class="registration-time">
            <view class="time-row">
              <text class="time-label">å¼€å§‹ï¼š</text>
              <picker mode="date" 
                      value="{{formData.registrationStartDate}}"
                      data-field="registrationStartDate"
                      bindchange="onFormFieldChange">
                <view class="{{ formData.registrationStartDate ? 'date-input small selected' : 'date-input small placeholder' }}">
                  {{formData.registrationStartDate || 'å¼€å§‹æ—¥æœŸ'}}
                </view>
              </picker>
              <picker mode="time" 
                      value="{{formData.registrationStartTime}}"
                      data-field="registrationStartTime"
                      bindchange="onFormFieldChange">
                <view class="{{ formData.registrationStartTime ? 'time-input small selected' : 'time-input small placeholder' }}">
                  {{formData.registrationStartTime || 'æ—¶é—´'}}
                </view>
              </picker>
            </view>
            <view class="time-row">
              <text class="time-label">æˆªæ­¢ï¼š</text>
              <picker mode="date" 
                      value="{{formData.registrationEndDate}}"
                      data-field="registrationEndDate"
                      bindchange="onFormFieldChange">
                <view class="{{ formData.registrationEndDate ? 'date-input small selected' : 'date-input small placeholder' }}">
                  {{formData.registrationEndDate || 'æˆªæ­¢æ—¥æœŸ'}}
                </view>
              </picker>
              <picker mode="time" 
                      value="{{formData.registrationEndTime}}"
                      data-field="registrationEndTime"
                      bindchange="onFormFieldChange">
                <view class="{{ formData.registrationEndTime ? 'time-input small selected' : 'time-input small placeholder' }}">
                  {{formData.registrationEndTime || 'æ—¶é—´'}}
                </view>
              </picker>
            </view>
          </view>
        </view>

        <!-- å€™è¡¥é˜Ÿåˆ— -->
        <view class="form-item">
          <view class="form-label">å€™è¡¥é˜Ÿåˆ—</view>
          <view class="switch-item">
            <switch checked="{{formData.enableWaitingList}}" 
                    data-field="enableWaitingList"
                    bindchange="onSwitchChange" />
            <text class="switch-label">å½“äººæ•°å·²æ»¡æ—¶ï¼Œå…è®¸ç”¨æˆ·åŠ å…¥å€™è¡¥é˜Ÿåˆ—</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ´»åŠ¨æ ‡ç­¾ -->
    <view class="form-section">
      <view class="section-header">
        <text class="section-icon">ğŸ·ï¸</text>
        <text class="section-title">æ´»åŠ¨æ ‡ç­¾</text>
      </view>
      
      <view class="section-content">
        <view class="form-item">
          <view class="form-label">é€‰æ‹©æ ‡ç­¾</view>
          <view class="tag-selector">
            <view class="{{ formData.tags.includes(item) ? 'tag-option selected' : 'tag-option' }}"
                  wx:for="{{tagOptions}}"
                  wx:key="*this"
                  data-tag="{{item}}"
                  bindtap="onTagToggle">
              {{item}}
            </view>
          </view>
          <view class="form-hint">æœ€å¤šé€‰æ‹©5ä¸ªæ ‡ç­¾ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿäº†è§£æ´»åŠ¨ç±»å‹</view>
        </view>
      </view>
    </view>

    <!-- é«˜çº§è®¾ç½® -->
    <view class="form-section advanced-section" wx:if="{{showAdvancedSettings || formData.registrationMode === 'approval'}}">
      <view class="section-header" bindtap="toggleAdvancedSettings">
        <text class="section-icon">âš™ï¸</text>
        <text class="section-title">é«˜çº§è®¾ç½®</text>
        <text class="{{ showAdvancedSettings ? 'toggle-icon expanded' : 'toggle-icon' }}">â–¼</text>
      </view>
      
      <view class="section-content" wx:if="{{showAdvancedSettings}}">
        <!-- å¯è§æ€§ -->
        <view class="form-item">
          <view class="form-label">å¯è§æ€§</view>
          <view class="radio-group">
            <view class="{{ formData.visibility === 'public' ? 'radio-item checked' : 'radio-item' }}"
                  data-field="visibility"
                  data-value="public"
                  bindtap="onFormFieldChange">
              <text class="radio-icon">{{formData.visibility === 'public' ? 'â—' : 'â—‹'}}</text>
              <text class="radio-label">å…¬å¼€æ´»åŠ¨</text>
            </view>
            <view class="{{ formData.visibility === 'internal' ? 'radio-item checked' : 'radio-item' }}"
                  data-field="visibility"
                  data-value="internal"
                  bindtap="onFormFieldChange">
              <text class="radio-icon">{{formData.visibility === 'internal' ? 'â—' : 'â—‹'}}</text>
              <text class="radio-label">å†…éƒ¨æ´»åŠ¨</text>
            </view>
          </view>
        </view>

        <!-- è”ç³»ä¿¡æ¯ -->
        <view class="form-item">
          <view class="form-label">è”ç³»äºº</view>
          <input class="form-input" 
                 placeholder="è”ç³»äººå§“å" 
                 value="{{formData.contactPerson}}"
                 data-field="contactPerson"
                 bindinput="onFormFieldChange" />
        </view>

        <view class="form-item">
          <view class="form-label">è”ç³»ç”µè¯</view>
          <input class="form-input" 
                 type="number"
                 placeholder="è”ç³»ç”µè¯" 
                 value="{{formData.contactPhone}}"
                 data-field="contactPhone"
                 bindinput="onFormFieldChange" />
        </view>

        <!-- é€šçŸ¥è®¾ç½® -->
        <view class="form-item">
          <view class="form-label">æ´»åŠ¨æé†’</view>
          <view class="switch-item">
            <switch checked="{{formData.enableNotification}}" 
                    data-field="enableNotification"
                    bindchange="onSwitchChange" />
            <text class="switch-label">æ´»åŠ¨å¼€å§‹å‰å‘é€æé†’é€šçŸ¥</text>
          </view>
        </view>
      </view>
    </view>

    <!-- å‘å¸ƒæ§åˆ¶åŒºå— -->
    <view class="form-section publish-section">
      <view class="section-header">
        <text class="section-icon">ğŸ“¢</text>
        <text class="section-title">å‘å¸ƒè®¾ç½®</text>
      </view>
      
      <view class="section-content">
        <view class="publish-info">
          <text class="publish-status">çŠ¶æ€ï¼š{{formData.status === 'draft' ? 'è‰ç¨¿' : 'å·²å‘å¸ƒ'}}</text>
          <text class="publish-hint">
            {{canPublishImmediately ? 'ç®¡ç†å‘˜å¯ä»¥ç«‹å³å‘å¸ƒæ´»åŠ¨' : 'ç¤¾å·¥åˆ›å»ºçš„æ´»åŠ¨éœ€è¦ç®¡ç†å‘˜å®¡æ ¸'}}
          </text>
        </view>
      </view>
    </view>
    </scroll-view>
  </view>
  
  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <button class="action-btn secondary" bindtap="showPreview">
      <text class="btn-icon">ğŸ‘</text>
      <text class="btn-text">é¢„è§ˆ</text>
    </button>
    
    <button class="action-btn secondary" bindtap="saveAsDraft" loading="{{autoSaving}}">
      <text class="btn-icon">ğŸ’¾</text>
      <text class="btn-text">ä¿å­˜è‰ç¨¿</text>
    </button>
    
    <button class="action-btn primary" 
            bindtap="submitForm"
            data-publish="{{false}}"
            loading="{{submitting}}">
      <text class="btn-icon">ğŸ“</text>
      <text class="btn-text">{{mode === 'edit' ? 'æ›´æ–°' : 'ä¿å­˜'}}</text>
    </button>
    
    <button class="action-btn primary publish" 
            wx:if="{{canPublishImmediately}}"
            bindtap="submitForm"
            data-publish="{{true}}"
            loading="{{submitting}}">
      <text class="btn-icon">ğŸ“¢</text>
      <text class="btn-text">å‘å¸ƒ</text>
    </button>
  </view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-container" wx:if="{{loading}}">
  <view class="loading-content">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>

<!-- é¢„è§ˆå¼¹çª— -->
<view class="{{ showPreview ? 'preview-modal show' : 'preview-modal' }}" catchtap="hidePreview">
  <view class="modal-content" >
    <view class="modal-header">
      <text class="modal-title">æ´»åŠ¨é¢„è§ˆ</text>
      <button class="modal-close" bindtap="hidePreview">âœ•</button>
    </view>
    
    <scroll-view class="modal-body" scroll-y="true">
      <view class="preview-content">
        <!-- å°é¢å›¾ -->
        <image class="preview-cover" 
               wx:if="{{formData.coverImage}}"
               src="{{formData.coverImage}}" 
               mode="aspectFill"></image>
        
        <!-- æ´»åŠ¨ä¿¡æ¯ -->
        <view class="preview-info">
          <text class="preview-title">{{formData.title}}</text>
          <text class="preview-category" wx:if="{{selectedCategoryLabel}}">{{selectedCategoryLabel}}</text>
          
          <view class="preview-details">
            <view class="preview-item">
              <text class="item-icon">ğŸ•’</text>
              <text class="item-text">{{formData.startDate}} {{formData.startTime}}</text>
            </view>
            <view class="preview-item" wx:if="{{formData.location}}">
              <text class="item-icon">ğŸ“</text>
              <text class="item-text">{{formData.location}}</text>
            </view>
            <view class="preview-item">
              <text class="item-icon">ğŸ‘¥</text>
              <text class="item-text">é™{{formData.capacity}}äºº</text>
            </view>
          </view>
          
          <view class="preview-description">{{formData.description}}</view>
          
          <view class="preview-tags" wx:if="{{formData.tags.length > 0}}">
            <text class="tag-item" wx:for="{{formData.tags}}" wx:key="*this">{{item}}</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>
</view>

<!-- å¸®åŠ©å¼¹çª— -->
<view class="{{ showHelpModal ? 'help-modal show' : 'help-modal' }}" catchtap="hideHelp">
  <view class="modal-content" >
    <view class="modal-header">
      <text class="modal-title">å¡«å†™å¸®åŠ©</text>
      <button class="modal-close" bindtap="hideHelp">âœ•</button>
    </view>
    
    <view class="modal-body">
      <view class="help-content">
        <view class="help-section">
          <text class="help-title">ğŸ“ åŸºç¡€ä¿¡æ¯</text>
          <text class="help-text">â€¢ æ ‡é¢˜è¦ç®€æ´æ˜äº†ï¼Œçªå‡ºæ´»åŠ¨ç‰¹è‰²</text>
          <text class="help-text">â€¢ æè¿°è¦è¯¦ç»†è¯´æ˜æ´»åŠ¨å†…å®¹å’Œç›®æ ‡</text>
          <text class="help-text">â€¢ é€‰æ‹©åˆé€‚çš„åˆ†ç±»ä¾¿äºç”¨æˆ·æŸ¥æ‰¾</text>
        </view>
        
        <view class="help-section">
          <text class="help-title">ğŸ•’ æ—¶é—´è®¾ç½®</text>
          <text class="help-text">â€¢ æ´»åŠ¨æ—¶é—´ä¸èƒ½æ—©äºå½“å‰æ—¶é—´</text>
          <text class="help-text">â€¢ æŠ¥åæˆªæ­¢æ—¶é—´ä¸èƒ½æ™šäºæ´»åŠ¨å¼€å§‹</text>
        </view>
        
        <view class="help-section">
          <text class="help-title">ğŸ‘¥ æŠ¥åè®¾ç½®</text>
          <text class="help-text">â€¢ å¼€æ”¾æŠ¥åï¼šç”¨æˆ·ç›´æ¥æŠ¥å</text>
          <text class="help-text">â€¢ å®¡æ ¸æŠ¥åï¼šéœ€è¦ç®¡ç†å‘˜å®¡æ ¸</text>
          <text class="help-text">â€¢ å€™è¡¥é˜Ÿåˆ—ï¼šæ»¡å‘˜åç”¨æˆ·å¯æ’é˜Ÿ</text>
        </view>
      </view>
    </view>
  </view>
</view>
