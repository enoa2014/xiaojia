<scroll-view class="activities-page" scroll-y="true">
  <!-- é¡¶éƒ¨å¯¼èˆªï¼ˆå¯¹é½é¦–é¡µæ ·å¼ï¼‰ -->
  <view class="nav-header {{theme.headerBg}}">
    <view class="brand">ğŸ“… æ´»åŠ¨ä¸­å¿ƒ</view>
    <view class="nav-actions">
      <button class="publish-btn" wx:if="{{canCreateActivity}}" bindtap="toCreate">
        <text class="btn-icon">â•</text>
        <text>å‘å¸ƒæ´»åŠ¨</text>
      </button>
    </view>
  </view>

  <!-- æ´»åŠ¨ç±»å‹å¿«æ·å…¥å£ -->
  <view class="activity-types-section">
    <view class="section-header">
      <text class="section-title">æ´»åŠ¨ç±»å‹</text>
      <text class="section-subtitle">é€‰æ‹©æ„Ÿå…´è¶£çš„æ´»åŠ¨ç±»å‹</text>
    </view>
    
    <view class="types-grid">
      <view class="type-card" 
            wx:for="{{activityTypes}}" 
            wx:key="key"
            bindtap="filterByType"
            data-type="{{item.key}}">
        <view class="type-icon" style="background-color: {{item.color}};">
          <text class="icon-text">{{item.icon}}</text>
        </view>
        <text class="type-name">{{item.name}}</text>
        <text class="type-count">{{item.count}}ä¸ªæ´»åŠ¨</text>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰å’Œæœç´¢åŒºåŸŸ -->
  <view class="filter-section">
    <view class="search-container">
      <view class="search-bar {{searchKeyword ? 'active' : ''}}">
        <text class="search-icon">ğŸ”</text>
        <input class="search-input" 
               placeholder="æœç´¢æ´»åŠ¨åç§°æˆ–å…³é”®è¯"
               value="{{searchKeyword}}"
               bindinput="onSearchInput"
               bindconfirm="performSearch" />
        <button class="clear-btn" wx:if="{{searchKeyword}}" catchtap="clearSearch">
          <text class="clear-icon">âœ•</text>
        </button>
      </view>
      <button class="filter-btn" bindtap="showFilterOptions">
        <text class="filter-icon">ğŸ·ï¸</text>
      </button>
    </view>
    
    <view class="filter-tabs">
      <view class="tabs-container">
        <scroll-view class="tabs-scroll" scroll-x="true">
          <view class="tabs-list">
            <view class="tab {{item.key===activeFilter?'active':''}}"
                  wx:for="{{filterTabs}}"
                  wx:key="key"
                  data-key="{{item.key}}"
                  bindtap="switchFilter">
              <text class="tab-text">{{item.label}}</text>
              <text class="tab-count" wx:if="{{item.count}}">{{item.count}}</text>
            </view>
          </view>
        </scroll-view>
      </view>
    </view>
  </view>

  <!-- æ´»åŠ¨åˆ—è¡¨ -->
  <view class="activities-list">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-container" wx:if="{{loading}}">
      <view class="loading-content">
        <view class="skeleton-card" wx:for="{{[1,2,3]}}" wx:key="*this">
          <view class="skeleton-header"></view>
          <view class="skeleton-line"></view>
          <view class="skeleton-line short"></view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-container" wx:if="{{!loading && list.length === 0}}">
      <view class="empty-content">
        <text class="empty-icon">ğŸ“…</text>
        <text class="empty-title">æš‚æ— {{activeFilterLabel}}æ´»åŠ¨</text>
        <text class="empty-subtitle">{{searchKeyword ? 'å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶' : 'ç­‰å¾…æ›´å¤šç²¾å½©æ´»åŠ¨å‘å¸ƒ'}}</text>
        <button class="empty-action" bindtap="clearFilters" wx:if="{{searchKeyword}}">
          æ¸…é™¤æœç´¢æ¡ä»¶
        </button>
      </view>
    </view>

    <!-- é”™è¯¯çŠ¶æ€ -->
    <view class="error-container" wx:if="{{error && !loading}}">
      <view class="error-content">
        <text class="error-icon">ğŸ˜”</text>
        <text class="error-title">åŠ è½½å¤±è´¥</text>
        <text class="error-message">{{error}}</text>
        <button class="error-retry" bindtap="retryLoad">é‡æ–°åŠ è½½</button>
      </view>
    </view>

    <!-- æ´»åŠ¨å¡ç‰‡åˆ—è¡¨ -->
    <view class="activity-cards" wx:if="{{!loading && !error && list.length > 0}}">
      <view class="activity-card" 
            wx:for="{{list}}" 
            wx:key="_id"
            bindtap="toDetail" 
            data-id="{{item._id}}">
        
        <!-- æ´»åŠ¨å¤´éƒ¨ä¿¡æ¯ -->
        <view class="card-header">
          <view class="activity-type" style="background-color: {{item.typeColor}};">
            <text class="type-icon">{{item.typeIcon}}</text>
          </view>
          <view class="header-content">
            <text class="activity-title">{{item.title}}</text>
            <view class="activity-meta">
              <text class="meta-item">{{item.organizerName}}</text>
              <text class="meta-divider">Â·</text>
              <text class="meta-item">{{item.createdTimeText}}</text>
            </view>
          </view>
          <view class="card-status status-{{item.status}}">
            <text class="status-text">{{item.statusText}}</text>
          </view>
        </view>

        <!-- æ´»åŠ¨è¯¦ç»†ä¿¡æ¯ -->
        <view class="card-body">
          <text class="activity-description">{{item.description}}</text>
          
          <view class="activity-details">
            <view class="detail-item" wx:if="{{item.startTime}}">
              <text class="detail-icon">ğŸ•’</text>
              <text class="detail-text">{{item.startTimeText}}</text>
            </view>
            
            <view class="detail-item" wx:if="{{item.location}}">
              <text class="detail-icon">ğŸ“</text>
              <text class="detail-text">{{item.location}}</text>
            </view>
            
            <view class="detail-item" wx:if="{{item.capacity}}">
              <text class="detail-icon">ğŸ‘¥</text>
              <text class="detail-text">å®¹é‡ {{item.registeredCount || 0}}/{{item.capacity}}</text>
            </view>
            
            <view class="detail-item" wx:if="{{item.fee !== null && item.fee !== undefined}}">
              <text class="detail-icon">ğŸ’°</text>
              <text class="detail-text">{{item.fee === 0 ? 'å…è´¹' : 'Â¥' + item.fee}}</text>
            </view>
          </view>
        </view>

        <!-- æ´»åŠ¨æ“ä½œåŒºåŸŸ -->
        <view class="card-footer">
          <view class="activity-tags">
            <text class="activity-tag" wx:for="{{item.tags}}" wx:key="*this">{{item}}</text>
          </view>
          
          <view class="card-actions">
            <!-- æŠ¥åæŒ‰é’® -->
            <button class="action-btn register-btn" 
                    wx:if="{{item.canRegister}}"
                    bindtap="registerActivity"
                    data-id="{{item._id}}"
                    catchtap="true">
              <text class="btn-icon">âœ‹</text>
              <text class="btn-text">æŠ¥å</text>
            </button>
            
            <!-- å·²æŠ¥åçŠ¶æ€ -->
            <view class="action-status registered" wx:elif="{{item.isRegistered}}">
              <text class="status-icon">âœ…</text>
              <text class="status-text">å·²æŠ¥å</text>
            </view>
            
            <!-- æŸ¥çœ‹è¯¦æƒ…æŒ‰é’® -->
            <button class="action-btn detail-btn" 
                    bindtap="toDetail" 
                    data-id="{{item._id}}"
                    catchtap="true">
              <text class="btn-text">æŸ¥çœ‹è¯¦æƒ…</text>
              <text class="btn-arrow">ã€‰</text>
            </button>
          </view>
        </view>

        <!-- æ•°æ®è„±æ•é®ç½©ï¼ˆé’ˆå¯¹ç‰¹å®šè§’è‰²ï¼‰ -->
        <view class="privacy-mask" wx:if="{{item.needPrivacyMask}}">
          <text class="mask-text">éƒ¨åˆ†ä¿¡æ¯å·²éšè—</text>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{!loading && hasMore && list.length > 0}}">
      <button class="load-more-btn" bindtap="loadMore" loading="{{loadingMore}}">
        {{loadingMore ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}}
      </button>
    </view>
  </view>

  <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
  <view class="floating-fab" wx:if="{{canCreateActivity}}" bindtap="toCreate">
    <text class="fab-icon">â•</text>
  </view>
</scroll-view>

<!-- ç­›é€‰é€‰é¡¹å¼¹çª— -->
<view class="filter-modal {{showFilterModal ? 'show' : ''}}" catchtap="hideFilterModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">ç­›é€‰æ¡ä»¶</text>
      <button class="modal-close" bindtap="hideFilterModal">âœ•</button>
    </view>
    
    <view class="modal-body">
      <view class="filter-group">
        <text class="group-title">æ´»åŠ¨ç±»å‹</text>
        <view class="filter-options">
          <view class="filter-option {{filterOptions.type === item.key ? 'active' : ''}}"
                wx:for="{{activityTypes}}"
                wx:key="key"
                data-type="{{item.key}}"
                bindtap="selectFilterType">
            <text class="option-icon">{{item.icon}}</text>
            <text class="option-text">{{item.name}}</text>
          </view>
        </view>
      </view>
      
      <view class="filter-group">
        <text class="group-title">æ´»åŠ¨æ—¶é—´</text>
        <view class="filter-options">
          <view class="filter-option {{filterOptions.time === item.key ? 'active' : ''}}"
                wx:for="{{timeFilters}}"
                wx:key="key"
                data-time="{{item.key}}"
                bindtap="selectFilterTime">
            <text class="option-text">{{item.label}}</text>
          </view>
        </view>
      </view>
      
      <view class="filter-group">
        <text class="group-title">æ´»åŠ¨çŠ¶æ€</text>
        <view class="filter-options">
          <view class="filter-option {{filterOptions.status === item.key ? 'active' : ''}}"
                wx:for="{{statusFilters}}"
                wx:key="key"
                data-status="{{item.key}}"
                bindtap="selectFilterStatus">
            <text class="option-text">{{item.label}}</text>
          </view>
        </view>
      </view>
    </view>
    
    <view class="modal-actions">
      <button class="modal-btn secondary" bindtap="resetFilters">é‡ç½®</button>
      <button class="modal-btn primary" bindtap="applyFilters">åº”ç”¨ç­›é€‰</button>
    </view>
  </view>
</view>
