<view class="service-page" wx:if="{{!loading}}">
  <!-- å¯¼èˆªå¤´éƒ¨åŒº -->
  <view class="nav-header {{theme.headerBg}}">
    <view class="brand">ğŸ§° æœåŠ¡è®°å½•</view>
    <view class="nav-actions">
      <view class="nav-tool" bindtap="showServiceStats">
        <text class="nav-icon">ğŸ“Š</text>
      </view>
      <view class="nav-tool" bindtap="showSettings">
        <text class="nav-icon">âš™ï¸</text>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡å¡ç‰‡åŒº -->
  <view class="stats-section">
    <view class="stats-card">
      <view class="stats-header">
        <text class="stats-title">æœ¬æœˆæ¦‚å†µ</text>
        <text class="stats-period">{{currentMonth}}</text>
      </view>
      <view class="stats-content">
        <view class="stat-item">
          <text class="stat-number">{{monthlyStats.total || 0}}</text>
          <text class="stat-label">æ€»æœåŠ¡</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{monthlyStats.pending || 0}}</text>
          <text class="stat-label">å¾…å®¡æ ¸</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{monthlyStats.approved || 0}}</text>
          <text class="stat-label">å·²é€šè¿‡</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{monthlyStats.efficiency || '0%'}}</text>
          <text class="stat-label">é€šè¿‡ç‡</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿè®°å½•åŒº -->
  <view class="quick-section">
    <view class="section-header">
      <text class="section-title">âš¡ å¿«é€Ÿè®°å½•</text>
    </view>
    <view class="quick-actions">
      <view class="quick-btn" wx:for="{{serviceTypes}}" wx:key="key" 
            data-type="{{item.key}}" bindtap="quickRecord">
        <view class="quick-icon" style="background-color: {{item.color}};">{{item.icon}}</view>
        <text class="quick-text">{{item.name}}</text>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰æ§åˆ¶åŒº -->
  <view class="filter-section">
    <view class="filter-tabs">
      <block wx:for="{{statusTabs}}" wx:key="key">
        <view class="filter-tab {{currentStatus === item.key ? 'active' : ''}}" 
              data-status="{{item.key}}" bindtap="onStatusChange">
          <text class="tab-text">{{item.name}}</text>
          <text class="tab-count" wx:if="{{item.count > 0}}">{{item.count}}</text>
        </view>
      </block>
    </view>
    
    <view class="filter-controls">
      <scroll-view scroll-x class="type-chips">
        <block wx:for="{{typeFilters}}" wx:key="key">
          <view class="type-chip {{currentType === item.key ? 'active' : ''}}" 
                data-type="{{item.key}}" bindtap="onTypeChange">
            <text class="chip-icon">{{item.icon}}</text>
            <text class="chip-text">{{item.name}}</text>
          </view>
        </block>
      </scroll-view>
      
      <view class="toggle-section">
        <switch class="mine-toggle" checked="{{showMyOnly}}" bindchange="toggleMyOnly"/>
        <text class="toggle-text">åªçœ‹æˆ‘çš„</text>
      </view>
    </view>
  </view>

  <!-- æœåŠ¡è®°å½•åˆ—è¡¨åŒº -->
  <view class="records-section">
    <view class="section-header" wx:if="{{filteredRecords.length > 0}}">
      <text class="section-title">æœåŠ¡è®°å½•</text>
      <text class="section-subtitle">å…±{{filteredRecords.length}}æ¡</text>
    </view>
    
    <view class="records-list">
      <view class="record-item" wx:for="{{filteredRecords}}" wx:key="id" 
            bindtap="onRecordTap" data-id="{{item.id}}">
        <view class="record-header">
          <view class="service-type-badge" style="background-color: {{item.typeColor}};">
            <text class="type-icon">{{item.typeIcon}}</text>
            <text class="type-name">{{item.typeName}}</text>
          </view>
          <view class="record-status status-{{item.status}}">
            <text class="status-dot"></text>
            <text class="status-text">{{item.statusText}}</text>
          </view>
        </view>
        
        <view class="record-content">
          <view class="record-title">{{item.title || 'æœåŠ¡è®°å½•'}}</view>
          <view class="record-description">{{item.description || 'æš‚æ— æè¿°'}}</view>
          
          <view class="record-meta">
            <view class="meta-item">
              <text class="meta-icon">ğŸ“…</text>
              <text class="meta-text">{{item.dateText}}</text>
            </view>
            <view class="meta-item">
              <text class="meta-icon">ğŸ‘¤</text>
              <text class="meta-text">{{item.volunteerName}}</text>
            </view>
            <view class="meta-item" wx:if="{{item.patientName}}">
              <text class="meta-icon">ğŸ¥</text>
              <text class="meta-text">{{item.patientName}}</text>
            </view>
          </view>
          
          <view class="record-tags" wx:if="{{item.tags && item.tags.length > 0}}">
            <text class="record-tag" wx:for="{{item.tags}}" wx:key="*this">{{item}}</text>
          </view>
        </view>
        
        <!-- å¿«é€Ÿå®¡æ ¸æ“ä½œåŒº -->
        <view class="record-actions" wx:if="{{canReview && item.status === 'pending'}}">
          <button class="action-btn approve-btn" 
                  catchtap="onApprove" data-id="{{item.id}}">
            <text class="btn-icon">âœ…</text>
            <text class="btn-text">é€šè¿‡</text>
          </button>
          <button class="action-btn reject-btn" 
                  catchtap="onReject" data-id="{{item.id}}">
            <text class="btn-icon">âŒ</text>
            <text class="btn-text">é©³å›</text>
          </button>
          <button class="action-btn detail-btn" 
                  catchtap="onRecordDetail" data-id="{{item.id}}">
            <text class="btn-icon">ğŸ‘ï¸</text>
            <text class="btn-text">è¯¦æƒ…</text>
          </button>
        </view>
      </view>
    </view>
    
    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore}}" bindtap="loadMore">
      <text class="load-text">{{loadingMore ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}}</text>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{filteredRecords.length === 0 && !loading}}">
      <view class="empty-icon">â¤ï¸</view>
      <view class="empty-title">æš‚æ— æœåŠ¡è®°å½•</view>
      <view class="empty-desc">{{emptyStateDesc}}</view>
      <button class="empty-action" bindtap="quickRecord" data-type="visit" wx:if="{{canCreate}}">
        <text class="btn-icon">âœ¨</text>
        <text>åˆ›å»ºé¦–ä¸ªæœåŠ¡è®°å½•</text>
      </button>
    </view>
  </view>

  <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
  <view class="fab" bindtap="toCreateService" wx:if="{{canCreate}}">
    <text class="fab-icon">â•</text>
  </view>
</view>



<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-container" wx:if="{{loading}}">
  <view class="loading-header">
    <view class="skeleton-nav"></view>
    <view class="skeleton-stats">
      <view class="skeleton-card">
        <view class="skeleton-line long"></view>
        <view class="skeleton-grid">
          <view class="skeleton-stat" wx:for="{{[1,2,3,4]}}" wx:key="*this">
            <view class="skeleton-line short"></view>
            <view class="skeleton-line tiny"></view>
          </view>
        </view>
      </view>
    </view>
  </view>
  <view class="loading-content">
    <view class="skeleton-section">
      <view class="skeleton-line medium"></view>
      <view class="skeleton-actions">
        <view class="skeleton-action" wx:for="{{[1,2,3,4,5]}}" wx:key="*this"></view>
      </view>
    </view>
    <view class="skeleton-list">
      <view class="skeleton-record" wx:for="{{[1,2,3]}}" wx:key="*this">
        <view class="skeleton-record-header">
          <view class="skeleton-line short"></view>
          <view class="skeleton-line tiny"></view>
        </view>
        <view class="skeleton-record-content">
          <view class="skeleton-line long"></view>
          <view class="skeleton-line medium"></view>
          <view class="skeleton-line short"></view>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- é”™è¯¯çŠ¶æ€ -->
<view class="error-container" wx:if="{{error && !loading}}">
  <view class="error-content">
    <text class="error-icon">ğŸ˜”</text>
    <text class="error-title">åŠ è½½å¤±è´¥</text>
    <text class="error-message">{{error.message || 'æ— æ³•è·å–æœåŠ¡è®°å½•'}}</text>
    <button class="error-retry" bindtap="retryLoad">é‡æ–°åŠ è½½</button>
  </view>
</view>
