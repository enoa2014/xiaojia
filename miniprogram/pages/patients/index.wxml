<view class="page">
  <!-- è‡ªå®šä¹‰å¯¼èˆªå¤´ï¼ˆå‚ç…§æ–‡æ¡£ï¼‰ -->
  <view class="nav-header">
    <text>ğŸ‘¥ æ‚£è€…æ¡£æ¡ˆ</text>
    <view class="nav-actions">
      <text bindtap="search">ğŸ”</text>
      <text bindtap="toNew">â•</text>
    </view>
  </view>

  <!-- é¡¶éƒ¨ç»Ÿè®¡ï¼ˆå¯é€‰ï¼‰ -->
  <view class="stats">
    <view class="stat-card">
      <text class="stat-num">{{stats.patients}}</text>
      <text class="stat-label">æ¡£æ¡ˆæ€»æ•°</text>
    </view>
  </view>

  <!-- æœç´¢åŒºåŸŸï¼ˆæ–‡æ¡£ search-sectionï¼‰ -->
  <view class="search-section">
    <view class="search-bar">
      <text class="search-icon">ğŸ”</text>
      <input class="search-input" placeholder="æœç´¢æ‚£è€…æ¡£æ¡ˆ...ï¼ˆå§“å/å°¾4ä½ï¼‰" value="{{keyword}}" bindinput="onInput" confirm-type="search" bindconfirm="search"/>
      <button class="search-btn" loading="{{loading}}" bindtap="search">æœç´¢</button>
    </view>
  </view>

  <!-- é¡¶éƒ¨ç­›é€‰ tabsï¼ˆæ–‡æ¡£ filter-tabsï¼‰ -->
  <view class="filter-tabs">
    <block wx:for="{{tabs}}" wx:key="key">
      <view class="filter-tab {{item.key===tabKey?'active':''}}" data-key="{{item.key}}" bindtap="setTab">{{item.text}}</view>
    </block>
  </view>

  <!-- æ—¥æœŸä¸æœ‰è¯/æ— è¯ç­›é€‰ -->
  <view class="filters">
    <picker mode="date" value="{{fromDate}}" bindchange="setFromDate">
      <view class="date">{{fromDate || 'å¼€å§‹æ—¥æœŸ'}}</view>
    </picker>
    <picker mode="date" value="{{toDate}}" bindchange="setToDate">
      <view class="date">{{toDate || 'ç»“æŸæ—¥æœŸ'}}</view>
    </picker>
  </view>
  <!-- å»æ‰ å…¨éƒ¨/æœ‰è¯/æ— è¯ ç­›é€‰ -->

  <!-- ä¼˜å…ˆå…³æ³¨ç»„ï¼ˆæ–‡æ¡£ç¤ºä¾‹ï¼‰ -->
  <block wx:if="{{Object.keys(starred).length > 0}}">
    <view class="group-banner star">â­ ä¼˜å…ˆå…³æ³¨ ({{Object.keys(starred).length}})</view>
  </block>

  <!-- åˆ—è¡¨ï¼ˆæ–‡æ¡£ patient-card ç»“æ„ï¼‰ -->
  <block wx:for="{{list}}" wx:key="_id">
    <view class="patient-card">
      <view class="patient-header">
        <view class="patient-avatar">{{item.initial}}</view>
        <view class="patient-content" bindtap="toDetail" data-id="{{item._id}}">
          <view class="patient-name">{{item.name || 'æœªå‘½å'}}<text wx:if="{{item.ageText}}"> Â· {{item.ageText}}</text></view>
          <view class="patient-meta">ç±è´¯ï¼š{{item.nativePlace || 'â€”'}} Â· æœ€è¿‘å…¥ä½ï¼š{{item.recentText}}</view>
          <view class="patient-tags">
            <text wx:for="{{item.tags}}" wx:key="*this" class="patient-tag">{{item}}</text>
          </view>
        </view>
        <button class="star-btn" catchtap="toggleStar" data-id="{{item._id}}">{{starred[item._id] ? 'â˜…' : 'â˜†'}}</button>
      </view>
      <view class="patient-actions">
        <button class="action-btn primary" catchtap="toTenancy" data-id="{{item._id}}">å…¥ä½ç®¡ç†</button>
        <button class="action-btn" catchtap="toService" data-id="{{item._id}}">æœåŠ¡è®°å½•</button>
        <button class="action-btn" catchtap="toDetail" data-id="{{item._id}}">æŸ¥çœ‹æ¡£æ¡ˆ</button>
      </view>
    </view>
  </block>

  <view class="empty" wx:if="{{!loading && list.length==0}}">æš‚æ— æ•°æ®</view>

  <!-- æµ®åŠ¨æ–°å»ºæŒ‰é’® -->
  <view class="floating-fab" bindtap="toNew">â•</view>
</view>
