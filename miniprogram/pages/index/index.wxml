
<view class="page">
  <!-- å¯¼èˆªå¤´éƒ¨åŒº -->
  <view class="nav-header {{theme.headerBg}} full-bleed">
  <view class="brand">ğŸ  å°å®¶æœåŠ¡ä¸­å¿ƒ</view>
  <view class="nav-actions">
    <view class="nav-tool nav-notif" wx:if="{{notifications>0}}" bindtap="wip">
      <text class="nav-icon">ğŸ””</text>
      <view class="nav-badge">{{notifications}}</view>
    </view>
    <text class="nav-tool nav-icon" bindtap="wip">ğŸ’¬</text>
    <text class="nav-tool nav-icon {{isRefreshing?'spin':''}}" bindtap="refreshTap">ğŸ”„</text>
    <text class="nav-tool nav-icon" bindtap="openRoleSwitcher">âš™ï¸</text>
  </view>
  </view>

<!-- ç”¨æˆ·çŠ¶æ€åŒº -->
<view class="user-status {{theme.userBg}}">
  <view class="user-profile">
    <view class="user-avatar">{{user.avatar || 'ğŸ‘©â€ğŸ’¼'}}</view>
    <view class="user-info">
      <view class="name-role-row">
        <text class="user-name">{{user.name}}</text>
        <view class="role-badge role-{{user.roleKey}}">{{user.roleName}}</view>
      </view>
      <view class="permissions-row">
        <text class="perm-text">{{user.permText}}</text>
        <view class="status-indicator active">
          <icon type="success" color="#22C55E" size="14" />
          <text>åœ¨çº¿</text>
        </view>
      </view>
    </view>
  </view>
  
  <view class="stats-summary">
    <view class="stats-item">
      <text class="stats-number">{{user.todayDone}}</text>
      <text class="stats-label">ä»Šæ—¥å®Œæˆ</text>
    </view>
    <view class="stats-divider"></view>
    <view class="stats-item">
      <text class="stats-number">{{user.todayTotal}}</text>
      <text class="stats-label">è®¡åˆ’ä»»åŠ¡</text>
    </view>
    <view class="time-display">
      <text class="current-time">{{user.now}}</text>
    </view>
  </view>

<!-- å¿«é€Ÿæ“ä½œåŒº -->
<view class="quick-actions-section" wx:if="{{!loading}}">
  <view class="section-header">
    <text class="section-title">ğŸ“Œ å¿«é€Ÿæ“ä½œ</text>
    <view class="role-indicator">{{user.roleName}}</view>
  </view>
  
  <view class="actions-grid">
    <block wx:for="{{actions}}" wx:key="key" wx:for-index="index">
      <view class="action-card {{selectedActionKey===item.key?'selected':''}}" 
            bindtap="onAction" 
            data-key="{{item.key}}"
            wx:if="{{index < 4}}">
        <view class="card-content">
          <view class="action-icon">{{item.icon}}</view>
          <view class="action-info">
            <text class="action-title">{{item.title}}</text>
            <text class="action-subtitle">{{item.subtitle}}</text>
          </view>
        </view>
        <view class="card-arrow">â€º</view>
      </view>
    </block>
  </view>
  
  <view class="more-actions" wx:if="{{actions.length > 4}}" bindtap="showAllActions">
    <text class="more-text">æŸ¥çœ‹æ›´å¤šæ“ä½œ</text>
    <text class="more-icon">â¬‡</text>
  </view>
 </view>
</view>

<!-- æ•°æ®æ€»è§ˆåŒº -->
<view class="data-overview-section" wx:if="{{!loading}}">
  <view class="section-header">
    <text class="section-title">ğŸ“Š æœ¬æœˆæ¦‚å†µ</text>
    <view class="overview-controls">
      <text class="period-text">æœ¬æœˆ</text>
      <text class="refresh-hint" bindtap="refreshTap">åˆ·æ–°</text>
    </view>
  </view>
  
  <scroll-view class="stats-scroll" 
               scroll-x="true" 
               enable-flex="true"
               show-scrollbar="false">
    <view class="stats-container">
      <block wx:for="{{stats}}" wx:key="key" wx:for-index="index">
        <view class="stat-card gradient-{{index % 4}}">
          <view class="card-header">
            <view class="stat-icon">{{item.icon}}</view>
            <view class="trend-indicator {{item.change && item.change.indexOf('+')===0 ? 'up' : 'down'}}" wx:if="{{item.change}}">
              <text class="trend-arrow">{{item.change && item.change.indexOf('+')===0 ? 'â†—' : 'â†˜'}}</text>
            </view>
          </view>
          <view class="card-body">
            <text class="stat-label">{{item.label}}</text>
            <text class="stat-value">{{item.value}}</text>
            <text class="stat-change" wx:if="{{item.change}}">{{item.change}} è¾ƒä¸ŠæœŸ</text>
          </view>
        </view>
      </block>
      
      <!-- å ä½å¡ç‰‡ç¡®ä¿æœ€åä¸€ä¸ªå¡ç‰‡æœ‰å³è¾¹è· -->
      <view class="spacer-card"></view>
    </view>
  </scroll-view>
  
  <view class="scroll-indicator">
    <view class="indicator-dots">
      <block wx:for="{{stats}}" wx:key="key" wx:for-index="index">
        <view class="dot {{index < 3 ? 'active' : ''}}" wx:if="{{index < Math.min(stats.length, 6)}}"></view>
      </block>
    </view>
  </view>
</view>

<!-- ä»»åŠ¡æé†’åŒº -->
<view class="tasks-section" wx:if="{{!loading}}">
  <view class="section-header">
    <text class="section-title">ğŸ“‹ å¾…åŠäº‹é¡¹</text>
    <view class="task-counter">
      <text class="counter-text">{{tasks.length}}</text>
      <view class="view-all-btn" bindtap="wip">
        <text>æŸ¥çœ‹å…¨éƒ¨</text>
        <text class="arrow">â€º</text>
      </view>
    </view>
  </view>
  
  <view class="tasks-list">
    <block wx:for="{{tasks}}" wx:key="id" wx:for-index="index">
      <view class="task-card priority-{{item.color === '#EF4444' ? 'high' : (item.color === '#F59E0B' ? 'medium' : 'normal')}}"
            wx:if="{{index < 3}}">
        <view class="task-main">
          <view class="priority-dot" style="background-color: {{item.color}};"></view>
          <view class="task-content">
            <text class="task-title">{{item.title}}</text>
            <text class="task-desc">{{item.desc}}</text>
          </view>
        </view>
        <view class="task-action">
          <text class="action-icon">â€º</text>
        </view>
      </view>
    </block>
    
    <view class="empty-tasks" wx:if="{{tasks.length === 0}}">
      <text class="empty-icon">âœ…</text>
      <text class="empty-text">æš‚æ— å¾…åŠäº‹é¡¹</text>
    </view>
  </view>
</view>

<!-- æœ€è¿‘åŠ¨æ€åŒº -->
<view class="updates-section" wx:if="{{!loading}}">
  <view class="section-header">
    <text class="section-title">ğŸ• æœ€è¿‘åŠ¨æ€</text>
    <view class="view-all-btn" bindtap="wip">
      <text>æŸ¥çœ‹å…¨éƒ¨</text>
      <text class="arrow">â€º</text>
    </view>
  </view>
  
  <view class="updates-timeline">
    <block wx:for="{{updates}}" wx:key="id" wx:for-index="index">
      <view class="update-entry" wx:if="{{index < 4}}">
        <view class="timeline-dot">
          <view class="dot-inner"></view>
        </view>
        <view class="update-content">
          <text class="update-text">{{item.text}}</text>
          <text class="update-time">{{item.time}}</text>
        </view>
      </view>
    </block>
    
    <view class="empty-updates" wx:if="{{updates.length === 0}}">
      <text class="empty-icon">ğŸ“°</text>
      <text class="empty-text">æš‚æ— åŠ¨æ€</text>
    </view>
  </view>
</view>

<!-- åº•éƒ¨å¯¼èˆªæç¤ºå¡ç‰‡ï¼ˆå·²ç§»é™¤æŒ‰è¦æ±‚ï¼‰ -->
<!-- éª¨æ¶å± -->
<view wx:if="{{loading}}" class="skeleton">
  <view class="sk-qa">
    <view class="sk-card"></view>
    <view class="sk-card"></view>
    <view class="sk-card"></view>
    <view class="sk-card"></view>
  </view>
  <view class="sk-stats">
    <view class="sk-stat"></view>
    <view class="sk-stat"></view>
    <view class="sk-stat"></view>
  </view>
  <view class="sk-tasks">
    <view class="sk-task"></view>
    <view class="sk-task"></view>
    <view class="sk-task"></view>
  </view>
  </view>
</view>
