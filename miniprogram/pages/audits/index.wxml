<view class="page">
  <!-- å¯¼èˆªå¤´éƒ¨ -->
  <view class="nav-header {{theme.headerBg}} full-bleed">
    <view class="brand">ğŸ›¡ï¸ å®¡è®¡æ—¥å¿—</view>
    <view class="nav-actions">
      <text wx:if="{{canView}}" class="nav-info">æœ€è¿‘7å¤©</text>
    </view>
  </view>

  <!-- æƒé™æ£€æŸ¥ -->
  <view wx:if="{{!canView}}" class="no-permission">
    <empty-state
      show="{{true}}"
      icon="ğŸ”’"
      title="æƒé™ä¸è¶³"
      description="å®¡è®¡æ—¥å¿—æŸ¥çœ‹åŠŸèƒ½ä»…ç®¡ç†å‘˜å¯ç”¨ï¼Œè¯·è”ç³»ç®¡ç†å‘˜è·å–è®¿é—®æƒé™"
      variant="compact">
    </empty-state>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:else>
    <!-- ç­›é€‰æ¡ä»¶ -->
    <view class="filters-section">
      <!-- æ“ä½œç±»å‹ç­›é€‰ -->
      <view class="filter-item">
        <text class="filter-label">æ“ä½œç±»å‹</text>
        <picker mode="selector" 
                range="{{actionOptions}}" 
                range-key="label" 
                value="0" 
                bindchange="onActionFilterChange">
          <view class="picker-input">
            <text class="picker-text">{{actionOptions[0].label}}</text>
            <text class="picker-arrow">ã€‰</text>
          </view>
        </picker>
      </view>

      <!-- æ—¥æœŸèŒƒå›´ -->
      <view class="filter-item">
        <text class="filter-label">æ—¶é—´èŒƒå›´</text>
        <view class="date-range">
          <picker mode="date" 
                  value="{{dateRange.start}}" 
                  bindchange="onStartDateChange">
            <view class="date-picker">
              <text class="date-text">{{dateRange.start || 'å¼€å§‹æ—¥æœŸ'}}</text>
            </view>
          </picker>
          <text class="date-separator">è‡³</text>
          <picker mode="date" 
                  value="{{dateRange.end}}" 
                  bindchange="onEndDateChange">
            <view class="date-picker">
              <text class="date-text">{{dateRange.end || 'ç»“æŸæ—¥æœŸ'}}</text>
            </view>
          </picker>
        </view>
      </view>

      <!-- æ“ä½œäººç­›é€‰ -->
      <view class="filter-item">
        <text class="filter-label">æ“ä½œäºº</text>
        <input class="filter-input"
               placeholder="è¾“å…¥ç”¨æˆ·IDæˆ–å§“å"
               value="{{actorFilter}}"
               bindinput="onActorFilterInput" />
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <loading-skeleton wx:if="{{loading && auditLogs.length === 0}}" 
                     type="list" count="5"></loading-skeleton>

    <!-- é”™è¯¯çŠ¶æ€ -->
    <error-view wx:elif="{{error}}"
                show="{{true}}"
                error="{{error}}"
                retry-text="é‡è¯•"
                variant="compact"
                bindretry="onRetryLoad">
    </error-view>

    <!-- å®¡è®¡æ—¥å¿—åˆ—è¡¨ -->
    <view wx:elif="{{auditLogs.length > 0}}" class="logs-section">
      <view class="logs-list">
        <block wx:for="{{auditLogs}}" wx:key="id">
          <view class="log-item" bindtap="onViewLogDetail" data-log-id="{{item.id}}">
            <view class="log-header">
              <view class="action-info">
                <view class="action-icon">{{getActionIcon(item.action)}}</view>
                <view class="action-details">
                  <text class="action-name">{{formatAction(item.action)}}</text>
                  <text class="action-time">{{formatTime(item.createdAt)}}</text>
                </view>
              </view>
              <view class="actor-info">
                <text class="actor-name">{{item.actorName || item.actorId}}</text>
              </view>
            </view>
            
            <view class="log-content">
              <view class="target-info">
                <text class="target-label">æ“ä½œç›®æ ‡ï¼š</text>
                <text class="target-value">{{maskTargetInfo(item.target)}}</text>
              </view>
              <view wx:if="{{item.requestId}}" class="request-info">
                <text class="request-label">è¯·æ±‚IDï¼š</text>
                <text class="request-id">{{item.requestId}}</text>
              </view>
              <view wx:if="{{item.ip}}" class="ip-info">
                <text class="ip-label">IPåœ°å€ï¼š</text>
                <text class="ip-value">{{item.ip}}</text>
              </view>
            </view>
            
            <view class="log-footer">
              <text class="detail-hint">ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</text>
            </view>
          </view>
        </block>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <empty-state wx:elif="{{!loading}}"
                 show="{{true}}"
                 icon="ğŸ“‹"
                 title="æ— å®¡è®¡è®°å½•"
                 description="åœ¨é€‰å®šçš„æ—¶é—´èŒƒå›´å†…æ²¡æœ‰æ‰¾åˆ°å®¡è®¡æ—¥å¿—"
                 variant="compact">
    </empty-state>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{hasMore && !loading && auditLogs.length > 0}}" class="load-more">
      <text class="load-more-text">ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
    </view>
    
    <view wx:elif="{{!hasMore && auditLogs.length > 0}}" class="no-more">
      <text class="no-more-text">å·²æ˜¾ç¤ºå…¨éƒ¨å†…å®¹</text>
    </view>
  </view>
</view>

